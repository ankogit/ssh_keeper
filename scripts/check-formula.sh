#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º—É–ª—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ Homebrew Core

set -e

# –¶–≤–µ—Ç–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

FORMULA_FILE="Formula/ssh-keeper-core.rb"

echo -e "${BLUE}üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è Homebrew Core${NC}"
echo "========================================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–æ—Ä–º—É–ª–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if [ ! -f "$FORMULA_FILE" ]; then
    echo -e "${RED}‚ùå –§–æ—Ä–º—É–ª–∞ $FORMULA_FILE –Ω–µ –Ω–∞–π–¥–µ–Ω–∞${NC}"
    exit 1
fi

echo -e "${YELLOW}üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Ruby...${NC}"
if ruby -c "$FORMULA_FILE"; then
    echo -e "${GREEN}‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å Ruby –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω${NC}"
else
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –≤ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ Ruby${NC}"
    exit 1
fi

echo -e "${YELLOW}üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è —Ñ–æ—Ä–º—É–ª—ã...${NC}"
if brew style "$FORMULA_FILE"; then
    echo -e "${GREEN}‚úÖ –°—Ç–∏–ª—å —Ñ–æ—Ä–º—É–ª—ã –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω${NC}"
else
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∏ –≤ —Å—Ç–∏–ª–µ —Ñ–æ—Ä–º—É–ª—ã${NC}"
    echo -e "${YELLOW}–ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ —Å—Ç–∏–ª—è –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞${NC}"
fi

echo -e "${YELLOW}üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º—É–ª—ã (audit)...${NC}"
if brew audit --new-formula "$FORMULA_FILE"; then
    echo -e "${GREEN}‚úÖ –§–æ—Ä–º—É–ª–∞ –ø—Ä–æ—à–ª–∞ audit${NC}"
else
    echo -e "${RED}‚ùå –§–æ—Ä–º—É–ª–∞ –Ω–µ –ø—Ä–æ—à–ª–∞ audit${NC}"
    echo -e "${YELLOW}–ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞${NC}"
fi

echo -e "${YELLOW}üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—ã...${NC}"
if brew test "$FORMULA_FILE"; then
    echo -e "${GREEN}‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ${NC}"
else
    echo -e "${RED}‚ùå –¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏${NC}"
    echo -e "${YELLOW}–ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö${NC}"
fi

echo ""
echo -e "${BLUE}üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:${NC}"
echo "=========================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
echo -e "${YELLOW}üìã –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:${NC}"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è
if grep -q 'desc "' "$FORMULA_FILE"; then
    echo -e "${GREEN}‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç${NC}"
else
    echo -e "${RED}‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ${NC}"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ homepage
if grep -q 'homepage "' "$FORMULA_FILE"; then
    echo -e "${GREEN}‚úÖ Homepage —É–∫–∞–∑–∞–Ω${NC}"
else
    echo -e "${RED}‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç homepage${NC}"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ URL
if grep -q 'url "' "$FORMULA_FILE"; then
    echo -e "${GREEN}‚úÖ URL —É–∫–∞–∑–∞–Ω${NC}"
else
    echo -e "${RED}‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç URL${NC}"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ SHA256
if grep -q 'sha256 "' "$FORMULA_FILE" && ! grep -q 'sha256 ""' "$FORMULA_FILE"; then
    echo -e "${GREEN}‚úÖ SHA256 —É–∫–∞–∑–∞–Ω${NC}"
else
    echo -e "${RED}‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –ø—É—Å—Ç–æ–π SHA256${NC}"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏
if grep -q 'license "' "$FORMULA_FILE"; then
    echo -e "${GREEN}‚úÖ –õ–∏—Ü–µ–Ω–∑–∏—è —É–∫–∞–∑–∞–Ω–∞${NC}"
else
    echo -e "${RED}‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–∏—Ü–µ–Ω–∑–∏—è${NC}"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–µ—Å—Ç–æ–≤
if grep -q 'test do' "$FORMULA_FILE"; then
    echo -e "${GREEN}‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç${NC}"
else
    echo -e "${RED}‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–µ—Å—Ç—ã${NC}"
fi

echo ""
echo -e "${BLUE}üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:${NC}"
echo "=================="
echo "1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø—Ä–æ–µ–∫—Ç–∞ –º–∏–Ω–∏–º—É–º 20 –∑–≤–µ–∑–¥ –Ω–∞ GitHub"
echo "2. –°–æ–∑–¥–∞–π—Ç–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑ (–Ω–µ pre-release)"
echo "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã"
echo "4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç"
echo "5. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è"

echo ""
echo -e "${GREEN}üéâ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!${NC}"



