# SSH Keeper - Проект для управления SSH соединениями

## Цель проекта

Создать удобное CLI приложение для хранения и управления SSH соединениями с красивым TUI интерфейсом и безопасным хранением паролей.

## Основные функции

- Сохранение связки: логин, хост, пароль/ключ
- Экспорт и импорт конфига (совместимость с OpenSSH)
- Запуск SSH подключения через системный ssh
- Вывод пароля / конфигурации
- Редактирование строки подключения
- Тестовое соединение
- Работа с authorized_keys

## Технологический стек

### Основные библиотеки

- **Bubble Tea** - TUI фреймворк для красивого интерфейса
- **Bubbles** - UI компоненты (таблицы, формы, поиск)
- **Termenv** - работа с терминалом и цветами
- **Reflow** - форматирование текста
- **Go-colorful** - работа с цветами
- **gokeyring-** - кроссплатформенное хранение паролей
- **pty** - прокидывание пароля в SSH сессию

### SSH интеграция

- **Системный OpenSSH** - использование `ssh` команды через exec.Command
- **OpenSSH config** - совместимость с ~/.ssh/config
- **authorized_keys** - работа с ключами авторизации

## Архитектура проекта

```
ssh_keeper/
├── cmd/
│   └── ssh-keeper/
│       └── main.go                 # Точка входа
├── internal/
│   ├── config/                    # Конфигурация приложения
│   │   └── config.go             # ~/.ssh-keeper/config.yaml
│   ├── storage/                   # Хранилище данных
│   │   ├── keyring.go            # go-keyring wrapper
│   │   └── connections.go        # connections.yaml
│   ├── ssh/                      # SSH интеграция
│   │   ├── client.go             # OpenSSH wrapper
│   │   ├── pty.go                # PTY для паролей
│   │   └── config.go             # OpenSSH config генерация
│   ├── ui/                       # TUI интерфейс
│   │   ├── main.go               # Главное меню
│   │   ├── list.go               # Список соединений
│   │   ├── form.go               # Форма добавления/редактирования
│   │   └── search.go             # Поиск соединений
│   ├── models/                   # Модели данных
│   │   ├── connection.go         # Структура SSH соединения
│   │   └── config.go             # Конфигурация приложения
│   └── auth/                     # Аутентификация
│       ├── master.go             # Мастер-ключ
│       └── session.go            # Управление сессией
├── pkg/
│   ├── keyring/                  # Обертка над go-keyring
│   │   └── keyring.go
│   └── ssh/                      # SSH утилиты
│       └── utils.go
├── go.mod
├── go.sum
├── Makefile
└── README.md
```

## Модели данных

### Connection (SSH соединение)

```go
type Connection struct {
    ID          string    `yaml:"id"`
    Name        string    `yaml:"name"`
    Host        string    `yaml:"host"`
    Port        int       `yaml:"port,omitempty"`
    User        string    `yaml:"user"`
    KeyPath     string    `yaml:"key_path,omitempty"`
    HasPassword bool      `yaml:"has_password"`
    CreatedAt   time.Time `yaml:"created_at"`
    UpdatedAt   time.Time `yaml:"updated_at"`
}
```

### Config (Конфигурация приложения)

```go
type Config struct {
    MasterKeyTimeout time.Duration `yaml:"master_key_timeout"`
    SSHPath         string        `yaml:"ssh_path"`
    ExportFormat    string        `yaml:"export_format"`
    DefaultPort     int           `yaml:"default_port"`
}
```

## Пользовательский флоу

1. **Запуск приложения**

   - Пользователь запускает `ssh-keeper`
   - Запрос мастер-ключа (если сессия истекла)

2. **Ввод мастер-ключа**

   - Мастер-ключ НЕ сохраняется локально
   - Хранится в памяти с таймаутом 1 час
   - Используется PBKDF2 + AES для шифрования паролей

3. **Главное меню**

   - Список SSH соединений
   - Поиск по названию/хосту/пользователю
   - Кнопки: добавить, подключиться, редактировать, удалить

4. **Добавление соединения**

   - Название (обязательно)
   - Хост (обязательно)
   - Порт (опционально, по умолчанию 22)
   - Пользователь (обязательно)
   - Путь до SSH ключа (опционально)
   - Пароль (опционально, сохраняется в go-keyring)

5. **Подключение**
   - Использование системного `ssh` через exec.Command
   - PTY для прокидывания пароля
   - Стандартный терминал для пользователя

## Безопасность

### Хранение паролей

- **go-keyring** для кроссплатформенного хранения
- **Мастер-ключ** в памяти с таймаутом 1 час
- **PBKDF2 + AES** для шифрования данных
- **Никаких локальных файлов** с паролями

### Поддерживаемые платформы

- **macOS** - Keychain
- **Linux** - Secret Service (GNOME Keyring, KDE Wallet)
- **Windows** - Credential Manager

## Экспорт/импорт

### Экспорт

- **OpenSSH config** - совместимый с ~/.ssh/config
- **Пароли** - отдельный файл для go-keyring
- **Полная миграция** - перенос на новый компьютер

### Импорт

- **OpenSSH config** - чтение существующих конфигураций
- **Массовый импорт** - из файлов конфигурации

## Конфигурация

### Расположение

- **~/.ssh-keeper/config.yaml** - настройки приложения
- **~/.ssh-keeper/connections.yaml** - список соединений
- **go-keyring** - пароли

### Настройки по умолчанию

- Таймаут мастер-ключа: 1 час
- Путь к SSH: системный `ssh`
- Формат экспорта: OpenSSH config
- Порт по умолчанию: 22

## Разработка

### Стандарты Go

- Go modules
- Стандартная структура проекта
- Тесты для всех компонентов
- Документация для публичных API

### Сборка

- **Makefile** для сборки
- **Brew** для macOS
- **Linux packages** (deb/rpm)
- **Кроссплатформенная** сборка

### TUI требования

- **Красивый интерфейс** с использованием всех указанных библиотек
- **Удобная навигация** клавиатурой
- **Поиск и фильтрация** в реальном времени
- **Цветовая схема** с поддержкой темной/светлой темы

## Следующие шаги

1. **Инициализация проекта** - go.mod, базовая структура
2. **Модели данных** - Connection, Config
3. **go-keyring интеграция** - кроссплатформенное хранение
4. **OpenSSH wrapper** - exec.Command + pty
5. **TUI интерфейс** - bubbletea + bubbles
6. **Экспорт/импорт** - OpenSSH совместимость
7. **Тестирование** - unit и integration тесты
8. **Сборка** - Makefile и пакеты
